# 実装計画

## フェーズ1：基盤とデータモデル

### 1. プロジェクト構造とコアインターフェースのセットアップ
- [x] 1.1 フロントエンド検索機能用ディレクトリ構造を作成
  - `frontend/src/components/search/` 配下にコンポーネントディレクトリ作成
  - `frontend/src/stores/search.ts` 検索状態管理ストア作成
  - `frontend/src/types/search.ts` 検索関連型定義作成
  - _要件：REQ-4（複合検索とフィルター管理）_

- [x] 1.2 バックエンド検索API用ディレクトリ構造を作成
  - `backend/app/api/v1/search.py` 検索エンドポイント作成
  - `backend/app/services/search_service.py` 検索ビジネスロジック作成
  - `backend/app/schemas/search.py` 検索リクエスト/レスポンススキーマ作成
  - _要件：REQ-6（パフォーマンスと可用性）_

- [x] 1.3 テストフレームワークの拡張設定
  - フロントエンド：検索コンポーネント用Vitestテスト環境設定
  - バックエンド：検索API用pytestテスト環境設定
  - E2E：検索フロー用Playwrightテスト環境設定

### 2. データモデルとスキーマの実装

- [x] 2.1 検索関連TypeScript型定義の作成
  - `SearchFilters` インターフェース：タグ、作成者、日付範囲フィルター定義
  - `WhiteboardSearchResult` インターフェース：検索結果表示用データ構造
  - `SearchResponse` インターフェース：ページネーション付き検索レスポンス
  - _要件：REQ-1,2,3（各種フィルター）、REQ-5（検索結果表示）_

- [x] 2.2 バックエンドPydanticスキーマの作成
  - `SearchFiltersSchema` クラス：入力検証付きフィルター定義
  - `WhiteboardSearchResultSchema` クラス：レスポンス用データ検証
  - `SearchResponseSchema` クラス：ページネーション付きレスポンス検証
  - _要件：REQ-6（バリデーションとエラーハンドリング）_

- [x] 2.3 データベーススキーマ拡張
  - タグテーブル作成（tags テーブル）：id, name, color, usage_count
  - ホワイトボード-タグ関連テーブル作成（whiteboard_tags テーブル）
  - Alembicマイグレーションスクリプト作成
  - _要件：REQ-1（タグによる検索）_

## フェーズ2：バックエンド検索機能

### 3. データベース最適化とリポジトリ実装

- [x] 3.1 検索最適化用インデックス作成
  - GINインデックス：全文検索用（title, description）
  - 複合インデックス：creator_id + created_at + updated_at
  - タグ検索用インデックス：whiteboard_tags テーブル
  - 権限チェック用インデックス：collaborators テーブル
  - _要件：REQ-6（200ms以内レスポンス時間）_

- [x] 3.2 WhiteboardRepositoryの検索メソッド実装
  - `find_by_filters()` メソッド：複合条件での検索実行
  - `count_by_filters()` メソッド：検索結果件数取得
  - `get_distinct_tags()` メソッド：ユーザーアクセス可能タグ一覧
  - _要件：REQ-1,2,3（各種フィルター検索）_

- [x] 3.3 権限フィルタリング機能の実装
  - アクセス権限チェック：自分のホワイトボード、共有ホワイトボード、パブリック
  - コラボレーター権限検証：閲覧、編集、管理者権限の区別
  - セキュリティフィルター：権限のないデータの自動除外
  - _要件：REQ-2（作成者フィルター）、セキュリティ要件_

### 4. 検索サービスとAPI実装

- [x] 4.1 SearchServiceコアロジック実装
  - テスト駆動：検索ロジックの単体テスト作成
  - `search_whiteboards()` メソッド：フィルター条件に基づく検索実行
  - `validate_search_filters()` メソッド：検索条件バリデーション
  - パフォーマンス最適化：クエリ実行時間監視
  - _要件：REQ-4（複合検索）、REQ-6（パフォーマンス）_

- [x] 4.2 検索APIエンドポイント実装
  - `POST /api/v1/search/whiteboards` エンドポイント：メイン検索機能
  - `GET /api/v1/search/tags` エンドポイント：利用可能タグ一覧
  - `GET /api/v1/search/authors` エンドポイント：作成者一覧
  - エラーハンドリング：400, 401, 500エラーの適切な処理
  - _要件：REQ-1,2,3（各種フィルター）_

- [x] 4.3 ページネーションと並び替え機能
  - fastapi-pagination統合：効率的なページネーション実装
  - ソート機能：created_at, updated_at, title（昇順・降順）
  - パフォーマンス考慮：大量データでの効率的な処理
  - _要件：REQ-5（検索結果表示と操作）_

## フェーズ3：フロントエンド検索UI

### 5. 状態管理とコアロジック

- [ ] 5.1 Pinia検索ストア実装
  - テスト駆動：ストアロジックの単体テスト作成
  - 検索フィルター状態管理：リアクティブなフィルター更新
  - 検索結果状態管理：結果キャッシュとページネーション
  - 永続化機能：フィルター状態のローカルストレージ保存
  - _要件：REQ-4（複合検索とフィルター管理）_

- [ ] 5.2 検索APIクライアント実装
  - `searchAPI.ts` モジュール：TypeScript型安全なAPIクライアント
  - 非同期検索処理：Promise/async-awaitベースの実装
  - エラーハンドリング：ネットワークエラー、APIエラーの処理
  - リトライ機能：一時的な接続エラーの自動復旧
  - _要件：REQ-6（可用性とエラーハンドリング）_

### 6. 検索UIコンポーネント実装

- [ ] 6.1 SearchPage.vue メインコンポーネント
  - ページレイアウト：検索フィルターと結果表示の統合
  - ルーティング統合：Vue Router による検索ページアクセス
  - SEO対応：メタタグとページタイトルの動的設定
  - _要件：全体統合_

- [ ] 6.2 TagFilter.vue コンポーネント
  - @vueform/multiselect統合：タグ選択UI実装
  - オートコンプリート：入力に応じたタグ候補表示
  - リアルタイム検索：タグ選択時の即座の結果更新
  - AND検索：複数タグの組み合わせ検索
  - _要件：REQ-1（タグによる検索・絞り込み）_

- [ ] 6.3 AuthorFilter.vue コンポーネント
  - ユーザー選択UI：アバター付きユーザー選択インターフェース
  - OR検索：複数作成者の選択（いずれか）
  - クイックフィルター：「自分のホワイトボード」ボタン
  - 非同期データロード：ユーザー一覧の動的取得
  - _要件：REQ-2（作成者による検索・絞り込み）_

- [ ] 6.4 DateRangeFilter.vue コンポーネント
  - Vue Tailwind Datepicker統合：日付範囲選択UI
  - プリセット機能：今日、今週、今月の簡単選択
  - バリデーション：開始日・終了日の妥当性チェック
  - 作成日・更新日切り替え：検索対象日付の選択
  - _要件：REQ-3（日付範囲による検索・絞り込み）_

### 7. 検索結果表示コンポーネント

- [ ] 7.1 SearchResults.vue コンポーネント
  - 検索結果リスト表示：ホワイトボード情報の一覧表示
  - ページネーション：10件単位での結果表示
  - ソート機能：作成日、更新日、タイトルでの並び替え
  - ローディング状態：検索中のインジケーター表示
  - _要件：REQ-5（検索結果の表示と操作）_

- [ ] 7.2 ResultCard.vue コンポーネント
  - ホワイトボードカード：タイトル、作成者、タグ、日付表示
  - クリック操作：ホワイトボード詳細ページへの遷移
  - レスポンシブデザイン：デスクトップ・モバイル対応
  - アクセシビリティ：キーボードナビゲーション対応
  - _要件：REQ-5（検索結果表示）_

- [ ] 7.3 フィルター状態表示機能
  - アクティブフィルター表示：適用中の検索条件を視覚化
  - 個別削除機能：各フィルターの個別解除ボタン
  - 全リセット機能：「フィルターをクリア」ボタン
  - 結果件数表示：「X件のホワイトボードが見つかりました」
  - _要件：REQ-4（フィルター管理）_

## フェーズ4：統合とテスト

### 8. テスト実装

- [ ] 8.1 ユニットテスト実装
  - フロントエンド：Vitestによるコンポーネント・ストアテスト（≥90%カバレッジ）
  - バックエンド：pytestによるサービス・リポジトリテスト（≥90%カバレッジ）
  - モック設定：外部依存関係のモック化
  - _要件：テスト戦略_

- [ ] 8.2 統合テスト実装
  - API統合テスト：全検索エンドポイントのテスト
  - データベース統合テスト：実際のPostgreSQLとの統合確認
  - フロントエンド-バックエンド統合：APIクライアントテスト
  - _要件：統合テスト戦略_

- [ ] 8.3 E2Eテスト実装
  - Playwright設定：検索ワークフローのエンドツーエンドテスト
  - 主要シナリオ：タグ検索、作成者検索、日付範囲検索、複合検索
  - エラーシナリオ：ネットワークエラー、無効な検索条件
  - パフォーマンステスト：検索レスポンス時間測定
  - _要件：REQ-6（パフォーマンステスト）_

### 9. パフォーマンス最適化

- [ ] 9.1 バックエンドパフォーマンス最適化
  - データベースクエリ最適化：インデックス使用状況の確認
  - 非同期処理最適化：asyncpgコネクションプール調整
  - キャッシュ戦略：Redis導入による検索結果キャッシュ
  - _要件：REQ-6（200ms以内レスポンス）_

- [ ] 9.2 フロントエンドパフォーマンス最適化
  - コンポーネント最適化：Vue 3のリアクティビティ最適化
  - バンドルサイズ最適化：不要なライブラリの除去
  - 遅延ローディング：大量データの段階的読み込み
  - _要件：REQ-6（UIレスポンス性）_

### 10. 最終統合とデプロイ

- [ ] 10.1 セキュリティテストとレビュー
  - セキュリティスキャン：OWASP Top 10対策確認
  - 権限テスト：アクセス制御の動作確認
  - APIセキュリティ：レート制限とCSRF対策確認
  - _要件：セキュリティ要件_

- [ ] 10.2 本番環境準備
  - 環境変数設定：本番用検索設定
  - データベースマイグレーション：本番環境でのスキーマ更新
  - 監視設定：検索パフォーマンス監視の設定
  - _要件：運用要件_

- [ ] 10.3 ドキュメント作成
  - API仕様書：検索エンドポイントのOpenAPI文書
  - ユーザーガイド：検索機能の使用方法説明
  - 開発者ドキュメント：コンポーネント仕様とカスタマイズ方法
  - _要件：保守性要件_

---

**実装優先度**：
- 🔴 **高優先度**：フェーズ1-2（基盤とバックエンド）
- 🟡 **中優先度**：フェーズ3（フロントエンドUI）  
- 🟢 **低優先度**：フェーズ4（テストと最適化）

**推定工数**：総計 25-30人日
- フェーズ1：3-4人日（✅完了）
- フェーズ2：8-10人日（✅完了）
- フェーズ3：10-12人日（⏳未着手）
- フェーズ4：4-6人日（⏳未着手）

**進捗状況**：
- 🟢 **フェーズ1（完了）**: 基盤とデータモデル - 6/6タスク完了
- 🟢 **フェーズ2（完了）**: バックエンド検索機能 - 10/10タスク完了
- 🔴 **フェーズ3（未着手）**: フロントエンド検索UI - 0/10タスク完了
- 🔴 **フェーズ4（未着手）**: 統合とテスト - 0/5タスク完了

**全体完了率**: 51.6% (16/31タスク完了)