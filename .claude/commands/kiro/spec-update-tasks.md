# /kiro:spec-update-tasks - タスク実装状況更新

実装進捗に基づいてKiro仕様書のtasks.mdファイルを更新し、完了したタスクをマーク、進捗状況を可視化します。

## 目的

- 完了したタスクを`[x]`としてマーク
- 実装状況を反映して進捗率を更新
- フェーズ完了状況を視覚的に表示
- 次のステップを明確化

## 引数

```
/kiro:spec-update-tasks <機能名>
```

- `<機能名>`: 更新対象の仕様書名（例: advanced-search）

## 実行手順

### 1. 対象仕様書の確認

```bash
# 対象の仕様書ディレクトリが存在するか確認
ls .kiro/specs/<機能名>/
```

必要ファイル:
- `tasks.md` - 更新対象のタスクファイル
- `spec.json` - 仕様書メタデータ

### 2. 実装状況の調査

以下の方法で実装状況を調査:

#### Gitコミット履歴の確認
```bash
# 最近のコミット確認
git log --oneline -10

# 特定機能に関するコミット確認
git log --grep="<機能名>" --oneline
```

#### ファイル存在確認
```bash
# 実装されたファイルの確認
find . -name "*search*" -type f | head -20
find . -name "*repository*" -type f
find . -name "*service*" -type f
```

#### テストファイル確認
```bash
# テストファイルの存在確認
find . -path "*/test*" -name "*search*" -type f
find . -path "*/test*" -name "*service*" -type f
```

#### マイグレーションファイル確認
```bash
# データベース変更の確認
ls backend/alembic/versions/ | grep -i search
ls backend/alembic/versions/ | grep -i tag
```

### 3. タスク完了状況の判定

各タスクについて以下の基準で完了判定:

#### バックエンドタスク
- **APIエンドポイント**: `backend/app/api/v1/<機能>.py` が存在
- **サービスクラス**: `backend/app/services/<機能>_service.py` が存在
- **リポジトリクラス**: `backend/app/repositories/<機能>_repository.py` が存在
- **スキーマ**: `backend/app/schemas/<機能>.py` が存在
- **マイグレーション**: `alembic/versions/` に関連ファイルが存在
- **テスト**: `backend/tests/` に関連テストファイルが存在

#### フロントエンドタスク
- **コンポーネント**: `frontend/src/components/<機能>/` が存在
- **ストア**: `frontend/src/stores/<機能>.ts` が存在
- **型定義**: `frontend/src/types/<機能>.ts` が存在
- **APIクライアント**: `frontend/src/api/<機能>.ts` が存在

#### インフラ・設定タスク
- **Docker設定**: 関連する設定変更が存在
- **環境変数**: 必要な環境変数が文書化
- **ドキュメント**: 関連ドキュメントが更新

### 4. tasks.mdファイルの更新

#### チェックボックス更新
完了したタスクを `[ ]` から `[x]` に変更:

```markdown
# 変更前
- [ ] 3.1 検索最適化用インデックス作成

# 変更後  
- [x] 3.1 検索最適化用インデックス作成
```

#### 進捗状況セクションの追加・更新

ファイル末尾に進捗状況を追加:

```markdown
**進捗状況**：
- 🟢 **フェーズ1（完了）**: 基盤とデータモデル - 6/6タスク完了
- 🟢 **フェーズ2（完了）**: バックエンド検索機能 - 10/10タスク完了  
- 🔴 **フェーズ3（未着手）**: フロントエンド検索UI - 0/10タスク完了
- 🔴 **フェーズ4（未着手）**: 統合とテスト - 0/5タスク完了

**全体完了率**: XX.X% (完了タスク数/総タスク数)
```

#### フェーズ状況の色分け
- 🟢 **完了**: すべてのタスクが完了
- 🟡 **進行中**: 一部のタスクが完了
- 🔴 **未着手**: タスクが未完了
- ⏳ **未着手**: 明示的に未着手を示す

### 5. 実装例

```markdown
**推定工数**：総計 25-30人日
- フェーズ1：3-4人日（✅完了）
- フェーズ2：8-10人日（✅完了）
- フェーズ3：10-12人日（⏳未着手）
- フェーズ4：4-6人日（⏳未着手）
```

### 6. 次のステップの明記

現在のフェーズ完了後、次にやるべきタスクを明確化:

```markdown
### 次のステップ

Phase 2が完了し、**フェーズ3（フロントエンド検索UI）**の実装が次の段階となります：
- 5.1 Pinia検索ストア実装
- 5.2 検索APIクライアント実装  
- 6.1-6.4 各種UIコンポーネント実装
- 7.1-7.3 検索結果表示コンポーネント実装
```

## 更新基準

### 完了とみなす条件

1. **コードが実装済み**: 該当する実装ファイルが存在
2. **テストが存在**: 対応するテストファイルが作成済み
3. **動作確認済み**: 基本的な動作が確認できる状態
4. **コミット済み**: Gitにコミット済み

### 未完了とみなす条件

1. **ファイルが存在しない**: 実装ファイルが見つからない
2. **実装が途中**: ファイルは存在するが実装が不完全
3. **テストが未実装**: テストファイルが存在しない
4. **エラーが発生**: 実装にバグや問題がある

## 注意点

### セーフティチェック

1. **tasks.mdのバックアップ**: 更新前に現在の状態を確認
2. **段階的更新**: 一度に大量のタスクをマークしない
3. **根拠の明記**: なぜそのタスクを完了とマークしたかの根拠を持つ
4. **他のチームメンバーとの同期**: 共同作業の場合は状況を共有

### 品質保証

1. **実装品質**: 完了マークする前にコードレビュー実施
2. **テストカバレッジ**: 適切なテストが存在することを確認
3. **ドキュメント更新**: 関連ドキュメントの更新も確認
4. **統合確認**: 他の機能との統合に問題がないか確認

## コマンド使用例

```bash
# advanced-search機能のタスク状況を更新
/kiro:spec-update-tasks advanced-search

# user-management機能のタスク状況を更新  
/kiro:spec-update-tasks user-management
```

## 期待される出力

```
タスク更新完了: advanced-search

更新内容:
✅ Phase 2完了タスクをマーク:
- 3.1 検索最適化用インデックス作成
- 3.2 WhiteboardRepositoryの検索メソッド実装  
- 3.3 権限フィルタリング機能の実装
- 4.1 SearchServiceコアロジック実装
- 4.2 検索APIエンドポイント実装
- 4.3 ページネーションと並び替え機能

✅ 進捗状況セクションを追加:
- 全体完了率: 51.6% (16/31タスク完了)
- フェーズ1・2完了、フェーズ3・4未着手を明記

次のステップ: フェーズ3（フロントエンド検索UI）の実装開始
```

## 関連コマンド

- `/kiro:spec-status <機能名>` - 仕様書の現在状況確認
- `/kiro:spec-tasks <機能名>` - タスク一覧の初期生成
- `/kiro:steering` - ステアリング文書の更新

## トラブルシューティング

### よくある問題

1. **tasks.mdファイルが見つからない**: 先に`/kiro:spec-tasks`で作成
2. **実装状況が不明**: 開発チームに現在の進捗を確認
3. **タスクの粒度が合わない**: 必要に応じてタスクを分割・統合
4. **進捗率の計算ミス**: 完了タスク数と総タスク数を再確認

### デバッグ方法

```bash
# ファイル存在確認
ls -la .kiro/specs/<機能名>/tasks.md

# 最近の変更確認
git log --oneline -5 -- .kiro/specs/<機能名>/tasks.md

# タスク数カウント確認
grep -c "^- \[" .kiro/specs/<機能名>/tasks.md
grep -c "^- \[x\]" .kiro/specs/<機能名>/tasks.md
```