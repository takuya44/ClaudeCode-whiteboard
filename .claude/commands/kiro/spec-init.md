---
description: 詳細なプロジェクト説明と要件に基づいて新しい仕様書を初期化する
allowed-tools: Bash, Read, Write, Glob
---

# 仕様書初期化

提供されたプロジェクト説明に基づいて新しい仕様書を初期化します：

**プロジェクト説明**: $ARGUMENTS

## ステアリングコンテキスト検証

### ステアリング文書の確認

- 構造コンテキスト: @.kiro/steering/structure.md
- 技術的制約: @.kiro/steering/tech.md
- プロダクトコンテキスト: @.kiro/steering/product.md

### ステアリングの存在確認

- ステアリングファイル: !`[ -d .kiro/steering ] && ls -la .kiro/steering/ || echo "ステアリングディレクトリが見つかりません - ステアリングコンテキストなしで続行します"`

**柔軟性**: 新機能や空のプロジェクトの場合、ステアリング文書は推奨されますが必須ではありません。ステアリング文書が存在しないか空の場合、仕様書生成フェーズに直接進むことができます。

## タスク: 仕様書構造の初期化

**スコープ**: このコマンドは、提供された詳細なプロジェクト説明に基づいてディレクトリ構造とメタデータを初期化します。

### 1. プロジェクト説明の分析

提供された説明（$ARGUMENTS）から以下を抽出：

- プロジェクトの目的と目標
- 主要機能と機能性
- 対象ユーザーや使用例
- 技術的要件や制約
- 言及された具体的な実装詳細

### 2. 機能名の生成

分析に基づいて、プロジェクトの本質を捉えた簡潔で説明的な機能名を作成。

### 3. 仕様書ディレクトリの作成

テンプレートファイル付きで`.kiro/specs/{生成された機能名}/`ディレクトリを作成：

- `requirements.md` - ユーザーストーリー用の空テンプレート
- `design.md` - 技術設計用の空テンプレート
- `tasks.md` - 実装タスク用の空テンプレート
- `spec.json` - メタデータと承認追跡

### 4. spec.json メタデータの初期化

承認追跡とプロジェクト説明を含む初期メタデータを作成：

```json
{
  "feature_name": "{生成された機能名}",
  "project_description": "$ARGUMENTS",
  "created_at": "現在のタイムスタンプ",
  "updated_at": "現在のタイムスタンプ",
  "language": "japanese",
  "phase": "initialized",
  "approvals": {
    "requirements": {
      "generated": false,
      "approved": false
    },
    "design": {
      "generated": false,
      "approved": false
    },
    "tasks": {
      "generated": false,
      "approved": false
    }
  },
  "ready_for_implementation": false
}
```

### 5. プロジェクトコンテキスト付きテンプレートファイルの作成

#### requirements.md（コンテキスト付きテンプレート）

```markdown
# 要件文書

## プロジェクト概要

{提供された説明に基づくプロジェクトの簡潔な概要}

## プロジェクト説明（ユーザー入力）

$ARGUMENTS

## 要件

<!-- 詳細なユーザーストーリーは/spec-requirementsフェーズで生成されます -->

---

**ステータス**: 要件生成の準備完了
**次のステップ**: 詳細な要件を生成するため`/spec-requirements {機能名}`を実行
```

#### design.md（空テンプレート）

```markdown
# 設計文書

## 概要

<!-- 技術設計は要件承認後に生成されます -->

---

**ステータス**: 要件承認待ち
**次のステップ**: まず要件を完了して承認してください
```

#### tasks.md（空テンプレート）

```markdown
# 実装計画

<!-- 実装タスクは設計承認後に生成されます -->

---

**ステータス**: 設計承認待ち  
**次のステップ**: まず設計を完了して承認してください
```

### 6. CLAUDE.md 参照の更新

生成された機能名と簡潔な説明とともに、新しい仕様書をアクティブな仕様書リストに追加。

## 初期化後の次のステップ

**インタラクティブ承認**を使用した適切な仕様駆動開発ワークフローに従います：

**インタラクティブ承認付きの合理化されたワークフロー:**

1. **要件生成**: `/spec-requirements {機能名}`
2. **インタラクティブ承認付き設計生成**: `/spec-design {機能名}`
   - プロンプト: "requirements.md をレビューしましたか？ [y/N]"
   - 'y'の場合: 要件を自動承認して設計を生成
   - 'N'の場合: 手動レビューのため停止
3. **インタラクティブ承認付きタスク生成**: `/spec-tasks {機能名}`
   - 要件と設計の両方のレビューを確認
   - 確認時に両フェーズを自動承認
4. **実装開始**: すべてのフェーズ完了後

**インタラクティブ承認の利点:**

- ✅ **手動での spec.json 編集不要**
- ✅ **確認プロンプトによるレビュー実施の維持**
- ✅ **即座の進行による合理化されたワークフロー**
- ✅ **適切なレビューのための停止機能による安全性の維持**

**従来の手動承認も引き続き利用可能:**
手動制御を希望する場合は、フェーズ間で spec.json を直接編集することもできます。

## 手順

1. **プロジェクト説明の解析** - 詳細な説明から主要情報を抽出
2. **適切な機能名の生成** - 簡潔で説明的な名前を作成
3. **ステアリング文書の確認** - 新機能には推奨されますが必須ではありません
4. **ディレクトリ構造の作成** - テンプレートにプロジェクトコンテキストを含める
5. **プロジェクト説明付きメタデータでの承認追跡設定**
6. **生成された機能名でユーザーに明確な次のステップを提供**
7. **柔軟なワークフローの有効化** - 適切な場合の要件への直接進行を許可

## 出力形式

初期化後、以下を提供：

1. 生成された機能名とその根拠
2. プロジェクトの簡潔な概要
3. 作成されたファイルパス
4. 実行する正確なコマンドを含む明確な次のステップ

これにより、各ステップ間の必須レビューフェーズを持つ適切な仕様駆動開発ワークフローが確保されます。
