---
description: 仕様書の実装タスクを生成する
allowed-tools: Bash, Read, Write, Edit, Update, MultiEdit
---

# 実装タスク

機能の詳細な実装タスクを生成：**$ARGUMENTS**

## インタラクティブ承認：要件と設計レビュー

**重要**：タスクは要件と設計の両方がレビューされ承認された後にのみ生成できます。

### インタラクティブレビュープロセス

- 要件文書：@.kiro/specs/$ARGUMENTS/requirements.md
- 設計文書：@.kiro/specs/$ARGUMENTS/design.md
- 仕様書メタデータ：@.kiro/specs/$ARGUMENTS/spec.json

**インタラクティブ承認プロセス**：

1. **文書の存在確認** - requirements.md と design.md が生成されていることを確認
2. **要件レビューのプロンプト** - ユーザーに質問：「requirements.md をレビューしましたか？ [y/N]」
3. **設計レビューのプロンプト** - ユーザーに質問：「design.md をレビューしましたか？ [y/N]」
4. **両方が'y'（はい）の場合**：両フェーズを承認するため spec.json を自動更新し、タスク生成に進む
5. **いずれかが'N'（いいえ）の場合**：実行を停止し、該当文書を最初にレビューするようユーザーに指示

**ユーザーが両方のレビューを確認したときの spec.json での自動承認更新**：

```json
{
  "approvals": {
    "requirements": {
      "generated": true,
      "approved": true // ← ユーザーが確認時に自動的にtrueに設定
    },
    "design": {
      "generated": true,
      "approved": true // ← ユーザーが確認時に自動的にtrueに設定
    }
  },
  "phase": "design-approved"
}
```

**ユーザーインタラクション例**：

```
📋 タスク生成前に要件と設計のレビューが必要です。
📄 レビューしてください：.kiro/specs/feature-name/requirements.md
❓ requirements.mdをレビューしましたか？ [y/N]: y
📄 レビューしてください：.kiro/specs/feature-name/design.md
❓ design.mdをレビューしましたか？ [y/N]: y
✅ 要件と設計が自動承認されました。タスク生成に進みます...
```

## コンテキスト分析

### 完全な仕様書コンテキスト（承認済み）

- 要件：@.kiro/specs/$ARGUMENTS/requirements.md
- 設計：@.kiro/specs/$ARGUMENTS/design.md
- 現在のタスク：@.kiro/specs/$ARGUMENTS/tasks.md
- 仕様書メタデータ：@.kiro/specs/$ARGUMENTS/spec.json

### ステアリングコンテキスト

- アーキテクチャパターン：@.kiro/steering/structure.md
- 開発プラクティス：@.kiro/steering/tech.md
- プロダクト制約：@.kiro/steering/product.md

## タスク：コード生成プロンプトの生成

**前提条件確認済み**：要件と設計の両方が承認され、タスク分解の準備が整っています。

**重要**：機能設計をテスト駆動方式で各ステップを実装するコード生成 LLM 用の一連のプロンプトに変換します。ベストプラクティス、段階的進歩、早期テストを優先し、どの段階でも複雑さの大きな飛躍がないことを確保してください。

spec.json で指定された言語で実装計画を作成：

### 1. コード生成タスク構造

spec.json で指定された言語で tasks.md を作成（`@.kiro/specs/$ARGUMENTS/spec.json`の"language"フィールドを確認）：

```markdown
# 実装計画

- [ ] 1. プロジェクト構造とコアインターフェースのセットアップ

  - モデル、サービス、リポジトリ、API コンポーネント用のディレクトリ構造を作成
  - 後続タスクで実装されるインターフェースを定義
  - テスト駆動開発用のテストフレームワークをセットアップ
  - _要件：1.1_

- [ ] 2. テスト駆動アプローチでデータモデルを実装
- [ ] 2.1 ベースモデル機能の作成

  - まずベースモデル動作のテストを作成
  - テストをパスするベース Entity クラスを実装
  - 共通プロパティと検証メソッドを含める
  - _要件：2.1, 2.2_

- [ ] 2.2 検証付き User モデルの実装

  - 検証エッジケースを含む User モデルテストを作成
  - メール検証とパスワードハッシュ化を持つ User クラスを作成
  - エッジケースをテスト：無効なメール、弱いパスワード、重複ユーザー
  - _要件：1.2, 1.3_

- [ ] 2.3 関係性を持つ主要ドメインモデルの実装

  - 関係性を含む[ドメイン]モデルのテストを作成
  - 関係性処理を持つ[ドメイン]クラスをコーディング
  - ビジネスロジックと検証ルールを実装
  - _要件：2.3, 2.4_

- [ ] 3. テスト駆動アプローチでデータアクセス層を作成
- [ ] 3.1 データベース接続ユーティリティの実装

  - まずデータベース接続シナリオのテストを作成
  - テストをパスする接続ユーティリティを実装
  - エラーハンドリングと接続プーリングを追加
  - _要件：3.1_

- [ ] 3.2 User データアクセス用リポジトリパターンの実装

  - まず CRUD 操作のリポジトリテストを作成
  - 標準データ操作を持つ User リポジトリを実装
  - 作成、読み取り、更新、削除シナリオをテスト
  - _要件：3.2, 3.3_

- [ ] 3.3 ドメイン固有リポジトリの実装

  - ドメインリポジトリ操作のテストを作成
  - ビジネス固有クエリを持つ[ドメイン]Repository をコーディング
  - 関係性読み込みとフィルタリング機能を含める
  - _要件：3.4_

- [ ] 4. テストファーストアプローチで API 層を構築
- [ ] 4.1 認証サービスとエンドポイントの作成
  - まず認証フローの API テストを作成
  - ログインと登録メソッドを持つ AuthService を構築
  - JWT トークン生成と検証を実装
```
