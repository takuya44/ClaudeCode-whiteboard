# ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

## 1. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥æ¦‚è¦

### 1.1 ãƒ†ã‚¹ãƒˆæ–¹é‡
- **å“è³ªå„ªå…ˆ**: 80%ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¶­æŒ
- **ç¶™ç¶šçš„ãƒ†ã‚¹ãƒˆ**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **éšå±¤åŒ–ãƒ†ã‚¹ãƒˆ**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆãƒ»E2Eãƒ†ã‚¹ãƒˆã®é©åˆ‡ãªçµ„ã¿åˆã‚ã›

### 1.2 ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰
```
      ğŸ”º E2Eãƒ†ã‚¹ãƒˆ (10%)
       æ‰‹å‹•ãƒ†ã‚¹ãƒˆãƒ»ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–
    
    ğŸ”ºğŸ”º çµ±åˆãƒ†ã‚¹ãƒˆ (20%)
     APIãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»WebSocket
  
  ğŸ”ºğŸ”ºğŸ”º ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (70%)
   é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```

### 1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Vitest + Vue Test Utils + Playwright
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: pytest + pytest-asyncio + httpx
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: pytest-postgresql + SQLAlchemy
- **E2E**: Playwright + Docker Compose

## 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

### 2.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆVitestï¼‰

#### 2.1.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
```typescript
// tests/components/WhiteboardCanvas.test.ts
import { describe, it, expect, vi } from 'vitest';
import { mount } from '@vue/test-utils';
import { createPinia } from 'pinia';
import WhiteboardCanvas from '@/components/whiteboard/WhiteboardCanvas.vue';
import { useWhiteboardStore } from '@/stores/whiteboard';

describe('WhiteboardCanvas', () => {
  it('ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹', () => {
    const wrapper = mount(WhiteboardCanvas, {
      global: {
        plugins: [createPinia()],
      },
      props: {
        whiteboardId: 'test-id',
        mode: 'edit'
      }
    });

    expect(wrapper.find('canvas').exists()).toBe(true);
    expect(wrapper.find('.canvas-container').classes()).toContain('editable');
  });

  it('æç”»é–‹å§‹æ™‚ã«é©åˆ‡ãªã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã•ã‚Œã‚‹', async () => {
    const wrapper = mount(WhiteboardCanvas, {
      global: {
        plugins: [createPinia()],
      },
      props: {
        whiteboardId: 'test-id',
        mode: 'edit'
      }
    });

    const canvas = wrapper.find('canvas');
    await canvas.trigger('mousedown', { clientX: 100, clientY: 100 });

    expect(wrapper.emitted('drawing-start')).toBeTruthy();
    expect(wrapper.emitted('drawing-start')[0]).toEqual([{
      x: 100,
      y: 100,
      tool: 'pen'
    }]);
  });
});
```

#### 2.1.2 Composables ãƒ†ã‚¹ãƒˆ
```typescript
// tests/composables/useDrawing.test.ts
import { describe, it, expect, vi } from 'vitest';
import { ref } from 'vue';
import { useDrawing } from '@/composables/useDrawing';

describe('useDrawing', () => {
  it('æç”»é–‹å§‹æ™‚ã«çŠ¶æ…‹ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹', () => {
    const { isDrawing, startDrawing, currentTool } = useDrawing();

    expect(isDrawing.value).toBe(false);
    
    startDrawing({ x: 100, y: 100 });
    
    expect(isDrawing.value).toBe(true);
  });

  it('æç”»ãƒ„ãƒ¼ãƒ«å¤‰æ›´ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', () => {
    const { currentTool, setTool } = useDrawing();

    expect(currentTool.value).toBe('pen');
    
    setTool('rectangle');
    
    expect(currentTool.value).toBe('rectangle');
  });
});
```

#### 2.1.3 Store ãƒ†ã‚¹ãƒˆ
```typescript
// tests/stores/whiteboard.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { setActivePinia, createPinia } from 'pinia';
import { useWhiteboardStore } from '@/stores/whiteboard';

describe('WhiteboardStore', () => {
  beforeEach(() => {
    setActivePinia(createPinia());
  });

  it('ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ä½œæˆãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', async () => {
    const store = useWhiteboardStore();
    
    const whiteboardData = {
      title: 'ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰',
      description: 'ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜'
    };

    await store.createWhiteboard(whiteboardData);

    expect(store.whiteboards).toHaveLength(1);
    expect(store.whiteboards[0].title).toBe('ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰');
  });

  it('æç”»è¦ç´ è¿½åŠ ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', () => {
    const store = useWhiteboardStore();
    
    const element = {
      id: 'test-element',
      type: 'pen',
      position: { x: 100, y: 100 },
      style: { color: '#000000' }
    };

    store.addElement(element);

    expect(store.currentElements).toHaveLength(1);
    expect(store.currentElements[0]).toEqual(element);
  });
});
```

### 2.2 çµ±åˆãƒ†ã‚¹ãƒˆ

#### 2.2.1 APIçµ±åˆãƒ†ã‚¹ãƒˆ
```typescript
// tests/integration/api.test.ts
import { describe, it, expect, beforeAll, afterAll } from 'vitest';
import { setupServer } from 'msw/node';
import { rest } from 'msw';
import { whiteboardApi } from '@/services/api/whiteboard';

const server = setupServer(
  rest.post('/api/whiteboards', (req, res, ctx) => {
    return res(ctx.json({
      id: 'test-id',
      title: 'Test Whiteboard',
      created_at: new Date().toISOString()
    }));
  }),
  
  rest.get('/api/whiteboards/:id', (req, res, ctx) => {
    return res(ctx.json({
      id: req.params.id,
      title: 'Test Whiteboard',
      elements: []
    }));
  })
);

beforeAll(() => server.listen());
afterAll(() => server.close());

describe('Whiteboard API Integration', () => {
  it('ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ä½œæˆAPIãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', async () => {
    const result = await whiteboardApi.create({
      title: 'Test Whiteboard',
      description: 'Test description'
    });

    expect(result).toEqual({
      id: 'test-id',
      title: 'Test Whiteboard',
      created_at: expect.any(String)
    });
  });

  it('ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰å–å¾—APIãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', async () => {
    const result = await whiteboardApi.getById('test-id');

    expect(result).toEqual({
      id: 'test-id',
      title: 'Test Whiteboard',
      elements: []
    });
  });
});
```

### 2.3 E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰

#### 2.3.1 ä¸»è¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
```typescript
// tests/e2e/whiteboard.spec.ts
import { test, expect } from '@playwright/test';

test.describe('ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰æ©Ÿèƒ½', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
    await page.fill('[data-testid="email"]', 'test@example.com');
    await page.fill('[data-testid="password"]', 'password123');
    await page.click('[data-testid="login-button"]');
    await page.waitForURL('/dashboard');
  });

  test('ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ä½œæˆãƒ»ç·¨é›†ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', async ({ page }) => {
    // ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ä½œæˆ
    await page.click('[data-testid="create-whiteboard"]');
    await page.fill('[data-testid="title-input"]', 'E2Eãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰');
    await page.click('[data-testid="create-button"]');
    
    // ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ç”»é¢ã¸ã®é·ç§»ç¢ºèª
    await page.waitForURL(/\/whiteboard\/[a-zA-Z0-9-]+/);
    
    // ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('[data-testid="whiteboard-canvas"]')).toBeVisible();
    
    // æç”»ãƒ†ã‚¹ãƒˆ
    const canvas = page.locator('[data-testid="whiteboard-canvas"]');
    await canvas.click({ position: { x: 100, y: 100 } });
    await canvas.dragTo(canvas, { 
      sourcePosition: { x: 100, y: 100 },
      targetPosition: { x: 200, y: 200 }
    });
    
    // æç”»è¦ç´ ãŒè¿½åŠ ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('[data-testid="element-count"]')).toContainText('1');
  });

  test('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±æœ‰ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹', async ({ page, context }) => {
    // 2ã¤ç›®ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
    const secondPage = await context.newPage();
    
    // 1ã¤ç›®ã®ãƒšãƒ¼ã‚¸ã§ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ä½œæˆ
    await page.click('[data-testid="create-whiteboard"]');
    await page.fill('[data-testid="title-input"]', 'å…±æœ‰ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰');
    await page.click('[data-testid="create-button"]');
    
    const url = page.url();
    
    // 2ã¤ç›®ã®ãƒšãƒ¼ã‚¸ã§åŒã˜ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹
    await secondPage.goto(url);
    
    // 1ã¤ç›®ã®ãƒšãƒ¼ã‚¸ã§æç”»
    const canvas1 = page.locator('[data-testid="whiteboard-canvas"]');
    await canvas1.click({ position: { x: 150, y: 150 } });
    
    // 2ã¤ç›®ã®ãƒšãƒ¼ã‚¸ã§æç”»ãŒåŒæœŸã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(secondPage.locator('[data-testid="element-count"]')).toContainText('1');
  });
});
```

## 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

### 3.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆpytestï¼‰

#### 3.1.1 ã‚µãƒ¼ãƒ“ã‚¹å±¤ãƒ†ã‚¹ãƒˆ
```python
# tests/services/test_whiteboard_service.py
import pytest
from unittest.mock import AsyncMock, MagicMock
from app.services.whiteboard import WhiteboardService
from app.schemas.whiteboard import WhiteboardCreate
from app.models.whiteboard import Whiteboard

class TestWhiteboardService:
    @pytest.fixture
    def mock_repository(self):
        return AsyncMock()
    
    @pytest.fixture
    def service(self, mock_repository):
        return WhiteboardService(mock_repository)
    
    @pytest.mark.asyncio
    async def test_create_whiteboard_success(self, service, mock_repository):
        # Arrange
        whiteboard_data = WhiteboardCreate(
            title="ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
            description="ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜"
        )
        
        expected_whiteboard = Whiteboard(
            id="test-id",
            title="ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
            description="ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜",
            owner_id="user-id"
        )
        
        mock_repository.create.return_value = expected_whiteboard
        
        # Act
        result = await service.create_whiteboard(
            whiteboard_data, 
            owner_id="user-id"
        )
        
        # Assert
        assert result.title == "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰"
        assert result.description == "ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜"
        mock_repository.create.assert_called_once()
    
    @pytest.mark.asyncio
    async def test_get_whiteboard_by_id_success(self, service, mock_repository):
        # Arrange
        whiteboard_id = "test-id"
        expected_whiteboard = Whiteboard(
            id=whiteboard_id,
            title="ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰"
        )
        
        mock_repository.get_by_id.return_value = expected_whiteboard
        
        # Act
        result = await service.get_whiteboard_by_id(whiteboard_id)
        
        # Assert
        assert result.id == whiteboard_id
        mock_repository.get_by_id.assert_called_once_with(whiteboard_id)
    
    @pytest.mark.asyncio
    async def test_get_whiteboard_by_id_not_found(self, service, mock_repository):
        # Arrange
        whiteboard_id = "non-existent-id"
        mock_repository.get_by_id.return_value = None
        
        # Act & Assert
        with pytest.raises(ValueError, match="ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"):
            await service.get_whiteboard_by_id(whiteboard_id)
```

#### 3.1.2 APIå±¤ãƒ†ã‚¹ãƒˆ
```python
# tests/api/test_whiteboard_api.py
import pytest
from httpx import AsyncClient
from fastapi import status
from app.main import app

class TestWhiteboardAPI:
    @pytest.fixture
    async def client(self):
        async with AsyncClient(app=app, base_url="http://test") as client:
            yield client
    
    @pytest.fixture
    def auth_headers(self):
        # ãƒ†ã‚¹ãƒˆç”¨ã®JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
        return {"Authorization": "Bearer test-token"}
    
    @pytest.mark.asyncio
    async def test_create_whiteboard_success(self, client, auth_headers):
        # Arrange
        whiteboard_data = {
            "title": "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
            "description": "ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜",
            "is_public": False
        }
        
        # Act
        response = await client.post(
            "/api/whiteboards",
            json=whiteboard_data,
            headers=auth_headers
        )
        
        # Assert
        assert response.status_code == status.HTTP_201_CREATED
        data = response.json()
        assert data["title"] == "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰"
        assert data["description"] == "ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜"
        assert "id" in data
        assert "created_at" in data
    
    @pytest.mark.asyncio
    async def test_create_whiteboard_invalid_data(self, client, auth_headers):
        # Arrange
        whiteboard_data = {
            "title": "",  # ç©ºã®ã‚¿ã‚¤ãƒˆãƒ«
            "description": "ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜"
        }
        
        # Act
        response = await client.post(
            "/api/whiteboards",
            json=whiteboard_data,
            headers=auth_headers
        )
        
        # Assert
        assert response.status_code == status.HTTP_422_UNPROCESSABLE_ENTITY
        data = response.json()
        assert "title" in data["detail"][0]["loc"]
    
    @pytest.mark.asyncio
    async def test_get_whiteboard_unauthorized(self, client):
        # Act
        response = await client.get("/api/whiteboards/test-id")
        
        # Assert
        assert response.status_code == status.HTTP_401_UNAUTHORIZED
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

#### 3.2.1 ãƒªãƒã‚¸ãƒˆãƒªãƒ†ã‚¹ãƒˆ
```python
# tests/repositories/test_whiteboard_repository.py
import pytest
from sqlalchemy.ext.asyncio import AsyncSession
from app.repositories.whiteboard import WhiteboardRepository
from app.models.whiteboard import Whiteboard
from app.models.user import User

class TestWhiteboardRepository:
    @pytest.fixture
    async def db_session(self):
        # ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        # pytest-postgresql ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨
        pass
    
    @pytest.fixture
    def repository(self, db_session):
        return WhiteboardRepository(db_session)
    
    @pytest.fixture
    async def test_user(self, db_session):
        user = User(
            id="user-id",
            email="test@example.com",
            hashed_password="hashed_password"
        )
        db_session.add(user)
        await db_session.commit()
        return user
    
    @pytest.mark.asyncio
    async def test_create_whiteboard(self, repository, test_user):
        # Arrange
        whiteboard_data = {
            "title": "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
            "description": "ãƒ†ã‚¹ãƒˆç”¨ã®èª¬æ˜",
            "owner_id": test_user.id
        }
        
        # Act
        whiteboard = await repository.create(whiteboard_data)
        
        # Assert
        assert whiteboard.title == "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰"
        assert whiteboard.owner_id == test_user.id
        assert whiteboard.id is not None
    
    @pytest.mark.asyncio
    async def test_get_by_id(self, repository, test_user):
        # Arrange
        whiteboard = await repository.create({
            "title": "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
            "owner_id": test_user.id
        })
        
        # Act
        result = await repository.get_by_id(whiteboard.id)
        
        # Assert
        assert result.id == whiteboard.id
        assert result.title == "ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰"
    
    @pytest.mark.asyncio
    async def test_get_by_owner_id(self, repository, test_user):
        # Arrange
        await repository.create({
            "title": "ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰1",
            "owner_id": test_user.id
        })
        await repository.create({
            "title": "ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰2",
            "owner_id": test_user.id
        })
        
        # Act
        whiteboards = await repository.get_by_owner_id(test_user.id)
        
        # Assert
        assert len(whiteboards) == 2
        assert all(wb.owner_id == test_user.id for wb in whiteboards)
```

### 3.3 WebSocketãƒ†ã‚¹ãƒˆ

#### 3.3.1 WebSocketæ¥ç¶šãƒ†ã‚¹ãƒˆ
```python
# tests/websocket/test_whiteboard_websocket.py
import pytest
import json
from fastapi.testclient import TestClient
from app.main import app

class TestWhiteboardWebSocket:
    @pytest.fixture
    def client(self):
        return TestClient(app)
    
    def test_websocket_connection(self, client):
        # Act
        with client.websocket_connect("/ws/whiteboard/test-id") as websocket:
            # Assert
            assert websocket is not None
    
    def test_drawing_event_broadcast(self, client):
        # è¤‡æ•°ã®WebSocketæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
        with client.websocket_connect("/ws/whiteboard/test-id") as ws1:
            with client.websocket_connect("/ws/whiteboard/test-id") as ws2:
                # Act - 1ã¤ç›®ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æç”»ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
                drawing_event = {
                    "type": "drawing:start",
                    "data": {
                        "x": 100,
                        "y": 100,
                        "tool": "pen"
                    }
                }
                ws1.send_json(drawing_event)
                
                # Assert - 2ã¤ç›®ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå—ä¿¡
                received = ws2.receive_json()
                assert received["type"] == "drawing:broadcast"
                assert received["data"]["x"] == 100
                assert received["data"]["y"] == 100
```

## 4. ãƒ†ã‚¹ãƒˆç’°å¢ƒè¨­å®š

### 4.1 Vitestè¨­å®š
```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  test: {
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'dist/',
        '**/*.d.ts',
        '**/*.test.ts',
        '**/*.spec.ts'
      ],
      thresholds: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80
        }
      }
    },
    setupFiles: ['./tests/setup.ts']
  },
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  }
});
```

### 4.2 pytestè¨­å®š
```ini
# pytest.ini
[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --strict-markers
    --cov=app
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --cov-fail-under=80
    --asyncio-mode=auto
markers =
    unit: Unit tests
    integration: Integration tests
    e2e: End-to-end tests
    slow: Slow running tests
```

### 4.3 Playwrightè¨­å®š
```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    video: 'retain-on-failure',
    screenshot: 'only-on-failure'
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

## 5. CI/CDãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–

### 5.1 GitHub Actionsè¨­å®š
```yaml
# .github/workflows/test.yml
name: Test Suite
on: [push, pull_request]

jobs:
  frontend-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run unit tests
        run: npm run test:unit
        
      - name: Run integration tests
        run: npm run test:integration
        
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/coverage-final.json
          
  backend-tests:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test
          POSTGRES_DB: testdb
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
          
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
          
      - name: Run tests
        run: pytest
        env:
          DATABASE_URL: postgresql://postgres:test@localhost:5432/testdb
          
  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Install Playwright browsers
        run: npx playwright install --with-deps
        
      - name: Start services
        run: docker-compose up -d
        
      - name: Run E2E tests
        run: npx playwright test
        
      - name: Upload test results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
```

## 6. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†

### 6.1 ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ç®¡ç†
```python
# tests/fixtures/whiteboard_fixtures.py
import pytest
from app.models.whiteboard import Whiteboard
from app.models.user import User

@pytest.fixture
def sample_user():
    return User(
        id="user-123",
        email="test@example.com",
        full_name="ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼"
    )

@pytest.fixture
def sample_whiteboard(sample_user):
    return Whiteboard(
        id="whiteboard-123",
        title="ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
        description="ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰",
        owner_id=sample_user.id
    )

@pytest.fixture
def sample_drawing_elements():
    return [
        {
            "id": "element-1",
            "type": "pen",
            "position": {"x": 100, "y": 100},
            "style": {"color": "#000000", "width": 2}
        },
        {
            "id": "element-2",
            "type": "rectangle",
            "position": {"x": 200, "y": 200, "width": 100, "height": 50},
            "style": {"color": "#FF0000", "fill": "#FFFF00"}
        }
    ]
```

### 6.2 ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
```typescript
// tests/mocks/api.ts
import { rest } from 'msw';

export const handlers = [
  rest.get('/api/whiteboards', (req, res, ctx) => {
    return res(ctx.json([
      {
        id: 'whiteboard-1',
        title: 'ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰1',
        created_at: '2024-07-06T00:00:00Z'
      },
      {
        id: 'whiteboard-2',
        title: 'ãƒ†ã‚¹ãƒˆãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰2',
        created_at: '2024-07-06T01:00:00Z'
      }
    ]));
  }),
  
  rest.post('/api/whiteboards', (req, res, ctx) => {
    return res(ctx.json({
      id: 'new-whiteboard',
      title: 'New Whiteboard',
      created_at: new Date().toISOString()
    }));
  })
];
```

## 7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### 7.1 è² è·ãƒ†ã‚¹ãƒˆ
```python
# tests/performance/test_load.py
import asyncio
import aiohttp
import time
from concurrent.futures import ThreadPoolExecutor

async def test_api_load():
    """APIè² è·ãƒ†ã‚¹ãƒˆ"""
    async with aiohttp.ClientSession() as session:
        tasks = []
        for i in range(100):
            task = session.get(f'http://localhost:8000/api/whiteboards/test-{i}')
            tasks.append(task)
        
        start_time = time.time()
        responses = await asyncio.gather(*tasks, return_exceptions=True)
        end_time = time.time()
        
        # çµæœåˆ†æ
        success_count = sum(1 for r in responses if hasattr(r, 'status') and r.status == 200)
        avg_response_time = (end_time - start_time) / len(responses)
        
        assert success_count >= 95  # 95%ä»¥ä¸Šã®æˆåŠŸç‡
        assert avg_response_time < 0.1  # å¹³å‡å¿œç­”æ™‚é–“100msä»¥ä¸‹
```

### 7.2 WebSocketãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
```python
# tests/performance/test_websocket_load.py
import asyncio
import websockets
import json
import time

async def test_websocket_concurrent_connections():
    """WebSocketåŒæ™‚æ¥ç¶šè² è·ãƒ†ã‚¹ãƒˆ"""
    async def client_session(client_id):
        uri = f"ws://localhost:8000/ws/whiteboard/test-room"
        async with websockets.connect(uri) as websocket:
            # æç”»ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
            await websocket.send(json.dumps({
                "type": "drawing:start",
                "data": {"x": 100, "y": 100, "client_id": client_id}
            }))
            
            # å¿œç­”å¾…æ©Ÿ
            response = await websocket.recv()
            return json.loads(response)
    
    # 100å€‹ã®åŒæ™‚æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
    start_time = time.time()
    tasks = [client_session(i) for i in range(100)]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    end_time = time.time()
    
    # çµæœæ¤œè¨¼
    success_count = sum(1 for r in results if isinstance(r, dict))
    total_time = end_time - start_time
    
    assert success_count >= 95  # 95%ä»¥ä¸Šã®æˆåŠŸç‡
    assert total_time < 5.0     # 5ç§’ä»¥å†…å®Œäº†
```

## 8. å“è³ªç®¡ç†

### 8.1 ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸
```json
{
  "coverage": {
    "thresholds": {
      "global": {
        "branches": 80,
        "functions": 80,
        "lines": 80,
        "statements": 80
      },
      "each": {
        "branches": 70,
        "functions": 70,
        "lines": 70,
        "statements": 70
      }
    }
  }
}
```

### 8.2 ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
```yaml
# .github/workflows/test-report.yml
name: Test Report
on:
  workflow_run:
    workflows: ["Test Suite"]
    types: [completed]

jobs:
  test-report:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Test Report
        uses: dorny/test-reporter@v1
        with:
          name: Test Results
          path: test-results.xml
          reporter: java-junit
```

---
**ä½œæˆæ—¥**: 2024å¹´7æœˆ6æ—¥  
**ä½œæˆè€…**: [QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å]  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼è€…**: [é–‹ç™ºãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼å]  
**æ‰¿èªè€…**: [æŠ€è¡“ãƒªãƒ¼ãƒ€ãƒ¼å]  
**ç‰ˆæ•°**: 1.0.0