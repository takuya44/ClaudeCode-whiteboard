# 実装計画書

## 🎯 プロジェクト概要

4人チームでオンラインホワイトボードアプリを開発する実装計画書

### チーム構成（想定）
- **フロントエンド担当**: 2名
- **バックエンド担当**: 2名

## 📋 実装フェーズ

### Phase 1: プロジェクト基盤構築 (Week 1-2) ✅ **完了**
- ✅ 要件定義・設計完了
- ✅ Docker環境構築完了
- ✅ プロジェクト構成作成完了

### Phase 2: 基盤実装 (Week 3-4) ✅ **完了**
- ✅ バックエンド基盤（FastAPI + PostgreSQL）
- ✅ フロントエンド基盤（Vue 3 + TypeScript）
- ✅ データベース設計・マイグレーション

### Phase 3: コア機能実装 (Week 5-6) ✅ **完了**
- ✅ 描画機能（Canvas描画エンジン）
- ✅ リアルタイム同期（WebSocket通信）
- ✅ 認証・権限管理（JWT認証）
- ✅ API実装（REST + WebSocket）

### Phase 4: 統合・テスト (Week 7-8) 🚧 **進行中**
- ✅ フロントエンド・バックエンド基本統合
- 🚧 API未実装箇所の完成
  - プロフィール更新API (`/auth/profile`)
  - パスワード変更API (`/auth/change-password`)
  - ホワイトボード共有API (`/whiteboards/{id}/share`)
  - コラボレーター管理API (`/whiteboards/{id}/collaborators`)
- 🎯 ストア層とAPI層の完全統合
- 🎯 WebSocket通信の完全実装
- 🎯 エンドツーエンドテスト
- 🎯 パフォーマンス最適化
- 🎯 セキュリティテスト

### Phase 5: 本番準備 (Week 9-10) ⏳ **準備中**
- CI/CDパイプライン構築
- 監視・ログシステム
- バックアップ・災害復旧
- デプロイ・運用準備

## 👥 担当分担表

### フロントエンド チーム

#### 🎨 フロントエンド担当者A
**担当範囲**: UI/UXコンポーネント・状態管理

**実装対象**:
- プロジェクト初期設定
- 共通UIコンポーネント
- レイアウト・ルーティング
- 状態管理（Pinia）設定

**成果物**:
```
frontend/
├── src/
│   ├── components/common/     # 共通コンポーネント
│   ├── components/ui/         # UIコンポーネント
│   ├── stores/               # 状態管理
│   ├── router/               # ルーティング
│   └── layouts/              # レイアウト
├── vite.config.ts
├── tailwind.config.js
└── tsconfig.json
```

**スケジュール**:
- Week 3: プロジェクト設定・共通コンポーネント
- Week 4: レイアウト・ルーティング・状態管理
- Week 5-6: UIコンポーネント完成
- Week 7-8: 統合・調整

---

#### 🖌️ フロントエンド担当者B
**担当範囲**: Canvas描画・WebSocket通信

**実装対象**:
- Canvas描画エンジン
- WebSocket接続・通信
- 描画ツール機能
- リアルタイム同期

**成果物**:
```
frontend/
├── src/
│   ├── components/whiteboard/ # ホワイトボード固有コンポーネント
│   ├── composables/          # Canvas・WebSocket用composables
│   ├── utils/               # 描画ユーティリティ
│   └── types/               # 型定義
└── tests/                   # フロントエンドテスト
```

**スケジュール**:
- Week 3: Canvas基盤・WebSocket接続 ✅ **完了 (2025-07-01)**
- Week 4: 基本描画機能（ペン・図形） ✅ **完了 (2025-07-01)**
- Week 5-6: テキスト・付箋機能（基盤実装済み）
- Week 7-8: リアルタイム同期・最適化（バックエンド実装待ち）

### バックエンド チーム

#### 🔧 バックエンド担当者A
**担当範囲**: API・データベース・認証

**実装対象**:
- FastAPI基盤構築
- データベース設計・マイグレーション
- 認証・権限管理
- REST API実装

**成果物**:
```
backend/
├── app/
│   ├── core/                # 設定・認証
│   ├── models/              # データベースモデル
│   ├── schemas/             # Pydanticスキーマ
│   ├── api/                # APIルーター
│   └── services/           # ビジネスロジック
├── alembic/                # マイグレーション
└── tests/                  # バックエンドテスト
```

**スケジュール**:
- Week 3: FastAPI基盤・データベース設計
- Week 4: 認証・ユーザー管理API
- Week 5-6: ホワイトボード管理API
- Week 7-8: テスト・最適化

---

#### 🌐 バックエンド担当者B  
**担当範囲**: WebSocket・リアルタイム通信

**実装対象**:
- WebSocketサーバー
- リアルタイム描画同期
- セッション管理
- 描画データ処理

**成果物**:
```
backend/
├── app/
│   ├── websocket/          # WebSocket処理
│   ├── utils/              # ユーティリティ
│   └── services/           # リアルタイム処理サービス
└── tests/websocket/        # WebSocketテスト
```

**スケジュール**:
- Week 3: WebSocket基盤・接続管理
- Week 4: 描画データ同期処理
- Week 5-6: セッション管理・最適化
- Week 7-8: パフォーマンス調整・テスト

## 📋 詳細タスク一覧

### Phase 2: 基盤実装 (Week 3-4)

#### Week 3 タスク

**フロントエンド担当者A** ✅ **完了済み (2025-07-01)**
- [x] Vite + Vue 3 + TypeScript セットアップ
- [x] Tailwind CSS 設定
- [x] ESLint + Prettier 設定
- [x] 基本的なフォルダ構成作成
- [x] 共通コンポーネント（Button, Input, Modal）
- [x] Pinia ストア初期設定

**フロントエンド担当者B** ✅ **完了済み (2025-07-01)**
- [x] Canvas API 基盤実装
- [x] WebSocket 接続クラス作成
- [x] 基本的な描画処理（線、点）
- [x] 描画イベント処理
- [x] TypeScript 型定義作成

**バックエンド担当者A** ✅ **完了済み (2025-07-02)**
- [x] FastAPI プロジェクト初期化
- [x] SQLAlchemy + Alembic 設定
- [x] データベース接続設定
- [x] ユーザーモデル作成
- [x] 認証ミドルウェア実装
- [x] 基本的なCRUD API

**バックエンド担当者B** ✅ **完了済み (2025-07-02)**
- [x] WebSocket 基盤実装
- [x] 接続管理クラス作成
- [x] メッセージ処理基盤
- [x] セッション管理基盤
- [x] エラーハンドリング

#### Week 4 タスク

**フロントエンド担当者A** ✅ **完了済み (2025-07-01)**
- [x] Vue Router 設定
- [x] レイアウトコンポーネント
- [x] ナビゲーション実装
- [x] 認証状態管理
- [x] API 通信設定（Axios）

**フロントエンド担当者B** ✅ **完了済み (2025-07-01)**
- [x] 描画ツール選択UI
- [x] 基本図形描画（四角、円）
- [x] 色・太さ選択機能
- [x] WebSocket メッセージ送受信
- [x] 描画データのシリアライズ

**バックエンド担当者A** ✅ **完了済み (2025-07-02)**
- [x] ホワイトボードモデル設計
- [x] 権限管理システム
- [x] ホワイトボード管理API
- [x] ユーザー管理API完成
- [x] データベースマイグレーション

**バックエンド担当者B** ✅ **完了済み (2025-07-02)**
- [x] 描画データ同期処理
- [x] マルチユーザー接続管理
- [x] 描画イベント配信
- [x] セッション永続化
- [x] パフォーマンス測定

### Phase 3: コア機能実装 (Week 5-8)

#### Week 5-6 主要機能実装

**フロントエンド** ✅ **完了済み (2025-07-01)**
- [x] 描画機能完成（ペン、図形、テキスト、付箋）
- [x] リアルタイム同期実装
- [x] ユーザーインターフェース完成
- [x] 保存・読み込み機能

**バックエンド** ✅ **完了済み (2025-07-02)**
- [x] 全API実装完了
- [x] リアルタイム同期完成
- [x] データ永続化完成
- [x] セキュリティ強化

#### Week 7-8 統合・最適化

**全体** 🚧 **統合作業進行中 (2025-07-03更新)**
- [x] フロント・バック基本統合
- 🚧 API未実装箇所の完成
  - [x] プロフィール更新API実装（バックエンド）✅ **完了 (2025-07-03)**
  - [x] パスワード変更API実装（バックエンド）✅ **完了 (2025-07-04)**
  - [ ] ホワイトボード共有・コラボレーター管理API実装（バックエンド）
  - 🚧 フロントエンドストア層のAPI統合
    - [x] AuthStore プロフィール更新統合 ✅ **完了 (2025-07-03)**
    - [ ] その他のストア統合
- [ ] WebSocket完全統合
  - [ ] 描画データのリアルタイム同期実装
  - [ ] セッション管理とユーザープレゼンス機能
  - [ ] 再接続処理とエラーハンドリング
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング強化
- [ ] テスト実装（次フェーズ）

## 🔄 開発フロー

### 1. ブランチ戦略
```
main
├── develop
├── feature/frontend-canvas
├── feature/backend-websocket
├── feature/auth-system
└── feature/database-design
```

### 2. 日次作業フロー
1. **朝**: スタンドアップMTG（15分）
2. **作業**: 各自担当タスク実装
3. **夕方**: 進捗共有・翌日計画

### 3. 週次作業フロー
- **月曜**: 週次計画MTG
- **水曜**: 中間レビュー
- **金曜**: 週次振り返り・デモ

## 🧪 テスト戦略

### フロントエンド
- **単体テスト**: Vitest
- **コンポーネントテスト**: Vue Test Utils
- **E2Eテスト**: Playwright

### バックエンド
- **単体テスト**: pytest
- **APIテスト**: FastAPI TestClient
- **WebSocketテスト**: pytest-asyncio

## 🔧 未実装タスク詳細

### API実装タスク

#### 認証関連API
1. **プロフィール更新API** (`PUT /api/v1/auth/profile`) ✅ **完了 (2025-07-03)**
   - 担当: バックエンド担当者A
   - 実装内容: ユーザー名、アバターの更新
   - フロントエンド側: `auth.ts` の `updateProfile` メソッド実装完了
   - 完了条件: ユーザー情報が更新され、更新後のユーザーデータがJSONで返される
   - **実装詳細**: UserUpdateスキーマを使用、JSON形式のリクエストボディに対応

2. **パスワード変更API** (`POST /api/v1/auth/change-password`) ✅ **完了 (2025-07-04)**
   - 担当: バックエンド担当者A
   - 実装内容: 現在のパスワード確認と新パスワードへの変更
   - フロントエンド側: `ProfileView.vue` で完全統合済み（エラーハンドリング・UI改善含む）
   - 完了条件: パスワードがハッシュ化されてDBに保存され、成功メッセージが返される
   - **実装詳細**: PasswordChangeスキーマ、キャメルケース対応、詳細エラーハンドリング実装

#### ホワイトボード管理API
3. **ホワイトボード共有API** (`POST /api/v1/whiteboards/{id}/share`)
   - 担当: バックエンド担当者A
   - 実装内容: メールアドレスリストを受け取り、共有権限を付与
   - フロントエンド側: `whiteboardApi.shareWhiteboard` メソッドで準備済み
   - 完了条件: APIが正常に動作し、共有権限がデータベースに保存される

4. **コラボレーター一覧取得API** (`GET /api/v1/whiteboards/{id}/collaborators`)
   - 担当: バックエンド担当者A
   - 実装内容: ホワイトボードのコラボレーター一覧を取得
   - フロントエンド側: `whiteboardApi.getCollaborators` メソッドで準備済み
   - 完了条件: コラボレーター情報（ユーザーID、名前、メール）がJSONで返される

5. **コラボレーター削除API** (`DELETE /api/v1/whiteboards/{id}/collaborators/{userId}`)
   - 担当: バックエンド担当者A
   - 実装内容: 指定されたユーザーのコラボレーター権限を削除
   - フロントエンド側: `whiteboardApi.removeCollaborator` メソッドで準備済み
   - 完了条件: 権限がデータベースから削除され、成功ステータスが返される

### フロントエンド・バックエンド連携タスク

#### ストア層の API 統合

##### AuthStore 関連
6. **AuthStore プロフィール更新統合** ✅ **完了 (2025-07-03)**
   - 担当: フロントエンド担当者A
   - 実装内容: `updateProfile` メソッドの TODO 解消
   - 依存: バックエンドのプロフィール更新API完成後
   - 完了条件: プロフィール更新がフロントエンドから実行でき、ストアに反映される
   - **実装詳細**: API呼び出し、エラーハンドリング、ストア更新処理を実装

##### WhiteboardStore 関連
7. **WhiteboardStore ホワイトボード一覧取得統合**
   - 担当: フロントエンド担当者B
   - 実装内容: `fetchWhiteboards` メソッドの TODO 解消
   - 完了条件: ホワイトボード一覧がストアに格納される

8. **WhiteboardStore ホワイトボード作成統合**
   - 担当: フロントエンド担当者B
   - 実装内容: `createWhiteboard` メソッドの TODO 解消
   - 完了条件: 新規ホワイトボードが作成でき、一覧に追加される

9. **WhiteboardStore 描画要素読み込み統合**
   - 担当: フロントエンド担当者B
   - 実装内容: `loadDrawingElements` メソッドの TODO 解消
   - 完了条件: ホワイトボードの描画要素がストアに格納される

#### WebSocket リアルタイム同期

##### フロントエンド側
10. **描画要素追加の WebSocket 送信**
    - 担当: フロントエンド担当者B
    - 実装内容: `addDrawingElement` メソッド内で WebSocket メッセージ送信
    - 完了条件: 描画追加時に WebSocket 経由でメッセージが送信される

11. **描画要素更新の WebSocket 送信**
    - 担当: フロントエンド担当者B
    - 実装内容: `updateDrawingElement` メソッド内で WebSocket メッセージ送信
    - 完了条件: 描画更新時に WebSocket 経由でメッセージが送信される

12. **描画要素削除の WebSocket 送信**
    - 担当: フロントエンド担当者B
    - 実装内容: `removeDrawingElement` メソッド内で WebSocket メッセージ送信
    - 完了条件: 描画削除時に WebSocket 経由でメッセージが送信される

##### バックエンド側
13. **描画イベント受信・配信機能**
    - 担当: バックエンド担当者B
    - 実装内容: WebSocket メッセージを受信し、同じホワイトボードの他ユーザーに配信
    - 完了条件: 描画イベントが全参加者にリアルタイムで共有される

14. **描画データ永続化機能**
    - 担当: バックエンド担当者B
    - 実装内容: WebSocket 経由で受信した描画データをデータベースに保存
    - 完了条件: 描画データが PostgreSQL に保存され、再読み込み可能

15. **アクティブユーザー管理機能**
    - 担当: バックエンド担当者B
    - 実装内容: ホワイトボードに接続中のユーザー一覧を管理
    - 完了条件: 接続・切断時にユーザーリストが更新され、他ユーザーに通知される

## 📊 進捗管理

### 進捗追跡ツール
- **タスク管理**: GitHub Projects / Trello
- **コミュニケーション**: Slack / Discord
- **ドキュメント**: この実装計画書 + 各種設計書

### 成果物チェックリスト

#### Week 3 完了基準
- [x] 開発環境が全員のマシンで動作 ✅ **フロントエンド完了**
- [x] 基本的なプロジェクト構成完成 ✅ **フロントエンド完了**
- [x] 各担当者の初期実装完了 ✅ **フロントエンド担当者A・B完了**

#### Week 4 完了基準 ✅ **完了 (2025-07-02)**
- [x] フロント・バック間の通信確立
- [x] 基本的なCRUD操作動作
- [x] 認証機能動作

#### Week 6 完了基準 ✅ **完了 (2025-07-02)**
- [x] 基本描画機能完成 ✅ **フロントエンド完了**
- [x] リアルタイム同期動作 ✅ **バックエンド完了**
- [x] 主要API完成 ✅ **バックエンド完了**

#### Week 8 完了基準 🚧 **進行中 (2025-07-04)**
- [x] 基本機能統合完了
- 🚧 API 実装完全統合
  - [x] プロフィール更新API ✅ **完了 (2025-07-03)**
  - [x] パスワード変更API ✅ **完了 (2025-07-04)**
  - [ ] ホワイトボード共有・コラボレーター管理API
- [ ] WebSocket リアルタイム同期完全動作
- [ ] テスト実装完了（次フェーズ）
- [ ] デプロイ準備完了（次フェーズ）

## 🚨 リスク管理

### 技術的リスク
1. **WebSocket接続の安定性**
   - 対策: 再接続機能・エラーハンドリング強化
   - 現状: フロントエンド側の WebSocket 基盤は実装済み、バックエンドとの統合が必要

2. **Canvas描画のパフォーマンス**
   - 対策: 描画最適化・イベント間引き
   - 現状: 基本的な描画機能は実装済み、大量データ時の最適化が今後の課題

3. **データベース設計変更**
   - 対策: マイグレーション戦略・バックアップ
   - 現状: 基本設計は完成、共有機能用のテーブル追加が必要な可能性

### スケジュールリスク
1. **技術習得時間**
   - 対策: 事前学習・ペアプログラミング
   - 現状: チームメンバーは基本技術を習得済み

2. **統合時の問題**
   - 対策: 早期統合・定期的な結合テスト
   - 現状: 基本統合は完了、API 未実装部分と WebSocket 完全統合が残件タスク

3. **API 仕様の認識齟齬**
   - 対策: API ドキュメントの徹底とチーム間コミュニケーション
   - 現状: フロントエンド側の API クライアントは実装済み、バックエンド側の実装が必要

## 📞 コミュニケーション

### 定期MTG
- **Daily**: 毎朝9:00-9:15（15分）
- **Weekly**: 毎週月曜10:00-11:00（1時間）
- **Review**: 毎週金曜16:00-17:00（1時間）

### 緊急時連絡
- **Slack**: 即座に回答が必要な場合
- **GitHub**: コードレビュー・技術的な質問
- **Issue**: バグ報告・機能要望

### 現在の優先事項 (2025-07-03)
1. **バックエンドチーム**: 未実装 API の即時実装
2. **フロントエンドチーム**: ストア層の API 統合
3. **全体**: WebSocket リアルタイム同期の完成

## 📌 重要な注意点

### 未実装タスクの依存関係
1. **バックエンド API 実装が先決事項**
   - フロントエンドのストア統合は API 実装待ち
   - API クライアントは既に実装済みなので、バックエンド実装後すぐに統合可能

2. **WebSocket リアルタイム同期は両チームの協力が必要**
   - フロントエンド: ストアからの WebSocket メッセージ送信
   - バックエンド: メッセージの受信・配信・永続化

3. **テスト・品質保証は統合完了後**
   - まずは機能の完全統合を優先
   - その後、包括的なテストを実施

この実装計画書をベースに、チーム全体で効率的に開発を進めていきましょう！

---

## 📊 現在の進捗状況 (2025-07-02更新)

### ✅ 完了済み (2025-07-02更新)
**全チーム**: フルスタックアプリケーション実装完了

#### フロントエンド担当者A & B
- [x] プロジェクト基盤設定（Vite + Vue 3 + TypeScript）
- [x] 共通UIコンポーネントシステム
- [x] 状態管理（Pinia）
- [x] ルーティング・レイアウト
- [x] Canvas描画エンジン（useCanvas composable）
- [x] WebSocket通信システム（useWebSocket composable）
- [x] 描画ツールUI（ペン、図形、色選択等）
- [x] API統合・エラーハンドリング

#### バックエンド担当者A & B
- [x] FastAPI基盤構築
- [x] PostgreSQL + SQLAlchemy + Alembic
- [x] JWT認証システム
- [x] REST API（認証・ホワイトボード・描画要素）
- [x] WebSocketサーバー・リアルタイム通信
- [x] データベース設計・マイグレーション
- [x] セキュリティ・パフォーマンス最適化

### 🎯 次のフェーズ（Phase 4）
**統合テスト・品質向上**
- [ ] エンドツーエンドテスト実装
- [ ] パフォーマンステスト・最適化
- [ ] セキュリティテスト強化
- [ ] ユーザビリティテスト
- [ ] CI/CDパイプライン構築
- [ ] 本番環境デプロイ準備

### 🎯 現在のマイルストーン (2025-07-04更新)
**プロジェクトステータス**: 🚧 **統合作業進行中**  
**動作確認**: ✅ http://localhost:3000 で基本動作確認可能  
**ログイン情報**: `test3@example.com` / `testpassword123`  

**🎉 本日の成果 (2025-07-04)**:
- ✅ パスワード変更API完全実装（バックエンド + フロントエンド統合）
- ✅ エラーハンドリング大幅改善（HTTPステータスコード別処理）
- ✅ ユーザビリティ向上（視覚的フィードバック、詳細エラーメッセージ）
- ✅ コードスタイル統一（ESLint警告解消）

**次のステップ**: 
1. ~~未実装 API の完成（プロフィール更新、パスワード変更、共有機能）~~ **2/4完了**
2. フロントエンドストア層の API 統合完了
3. WebSocket によるリアルタイム同期の完全実装
4. Phase 4 後半の統合テスト・品質向上作業

### 📝 TODO サマリー (2025-07-04更新)
- **バックエンド**: 4つの API エンドポイント実装（タスク2-5）✅ **2つ完了**
- **フロントエンド**: 3つのストアメソッド統合 + 3つの WebSocket 送信実装（タスク7-12）✅ **1つ完了**
- **バックエンド WebSocket**: 3つのリアルタイム機能実装（タスク13-15）

### 📈 実装優先順位
1. **バックエンド API** （タスク2-5）→ フロントエンド統合の前提条件 ✅ **2/4完了**
2. **フロントエンドストア統合** （タスク7-9）→ API 完成後即実装 ✅ **1/3完了**  
3. **WebSocket 機能** （タスク10-15）→ フロント・バック同時作業

### 🎯 次回実装タスク
**優先度：高**
- [x] ~~タスク2: パスワード変更API実装~~ ✅ **完了 (2025-07-04)**
- タスク3: ホワイトボード共有API実装 (`POST /api/v1/whiteboards/{id}/share`)
- タスク4: コラボレーター一覧取得API実装 (`GET /api/v1/whiteboards/{id}/collaborators`)
- タスク5: コラボレーター削除API実装 (`DELETE /api/v1/whiteboards/{id}/collaborators/{userId}`)

**優先度：中**
- タスク7: WhiteboardStore fetchWhiteboards統合
- タスク8: WhiteboardStore createWhiteboard統合
- タスク9: WhiteboardStore loadDrawingElements統合